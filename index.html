<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Hub | Cloud</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
        body { background: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%); color: white; min-height: 100vh; overflow-x: hidden; }
        #stars-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: url('https://www.transparenttextures.com/patterns/stardust.png'); animation: moveStars 100s linear infinite; opacity: 0.5; }
        @keyframes moveStars { from { background-position: 0 0; } to { background-position: 10000px 5000px; } }
        
        /* About Icon */
        .about-btn { position: fixed; top: 20px; right: 20px; z-index: 1100; font-size: 1.5rem; color: #00f2ff; cursor: pointer; background: rgba(0,0,0,0.3); width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid #00f2ff; }

        .header { text-align: center; padding: 60px 20px 20px; }
        .logo { font-size: 40px; font-weight: bold; text-shadow: 0 0 20px #00f2ff; margin-bottom: 20px; }
        
        #admin-panel { display: none; background: #2ecc71; color: white; padding: 15px; text-align: center; font-weight: bold; position: sticky; top: 0; z-index: 1000; }
        .owner-btn { background: #00f2ff; color: #000; border: none; padding: 10px 20px; border-radius: 50px; font-weight: bold; cursor: pointer; margin: 10px; }

        .search-container { max-width: 600px; margin: 0 auto 30px; }
        .search-container input { width: 100%; padding: 15px 25px; border-radius: 50px; border: 2px solid rgba(0, 242, 255, 0.4); background: rgba(0, 0, 0, 0.8); color: white; outline: none; }

        .subjects { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .card { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; text-align: center; cursor: pointer; transition: 0.4s ease; backdrop-filter: blur(10px); position: relative; }
        .card:hover { border-color: #00f2ff; background: rgba(0, 242, 255, 0.1); }
        .card i { font-size: 3rem; margin-bottom: 10px; display: block; }
        
        .notes-section { display: none; padding: 20px; max-width: 1000px; margin: 20px auto; background: rgba(0,0,0,0.9); border-radius: 25px; border: 1px solid #00f2ff; }
        .unit-card { background: rgba(255,255,255,0.05); margin: 10px 0; padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.1); cursor:pointer; }
        .unit-card:hover { border-color: #00f2ff; }

        /* WebView Container */
        #viewer-container { display: none; margin-top: 20px; border-radius: 15px; overflow: hidden; border: 1px solid #00f2ff; background: #fff; }
        #web-view { width: 100%; height: 600px; border: none; }
        .view-controls { display: flex; justify-content: space-between; background: #222; padding: 10px; }

        /* Popups */
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1a1a1a; padding: 30px; border-radius: 20px; border: 2px solid #00f2ff; z-index: 2000; text-align: center; width: 90%; max-width: 400px; }
        .modal h2 { margin-bottom: 15px; color: #00f2ff; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1500; }

        footer { padding: 40px; text-align: center; opacity: 0.6; cursor: pointer; }
    </style>
</head>
<body>

<div id="stars-container"></div>

<div class="about-btn" onclick="showAbout()"><i class="fa-solid fa-info"></i></div>

<div id="admin-panel">
    üõ°Ô∏è OWNER DASHBOARD | 
    <button class="owner-btn" onclick="addSubject()">+ Add Subject</button>
    <button class="owner-btn" style="background:#ff5252; color:#fff;" onclick="location.reload()">Exit</button>
</div>

<div class="header">
    <div class="logo">üöÄ STUDY HUB</div>
    <div class="search-container">
        <input type="text" id="masterSearch" placeholder="Search subjects..." onkeyup="handleSearch()">
    </div>
</div>

<div class="subjects" id="mainGrid"></div>

<div class="notes-section" id="notesArea">
    <h2 id="noteTitle" style="text-align:center; margin-bottom:20px;"></h2>
    <div id="unitList"></div>
    
    <div id="admin-url-box" style="display:none; margin-top:20px; padding:15px; border: 1px dashed #00f2ff; border-radius:10px;">
        <input type="text" id="pdfUrlInput" placeholder="Enter PDF/Website URL" style="width:100%; padding:10px; margin-bottom:10px; border-radius:5px; background:#000; color:#fff; border:1px solid #00f2ff;">
        <button class="owner-btn" onclick="saveUrl()">Link URL to Unit</button>
    </div>

    <div id="viewer-container">
        <div class="view-controls">
            <button onclick="toggleFullScreen()" class="owner-btn" style="padding:5px 15px;"><i class="fa-solid fa-expand"></i> Full Screen</button>
            <button id="dlBtn" class="owner-btn" style="background:#2ecc71; padding:5px 15px;"><i class="fa-solid fa-download"></i> Download</button>
        </div>
        <iframe id="web-view" src=""></iframe>
    </div>

    <button class="owner-btn" style="background:#ff5722; color:white; margin-top:20px;" onclick="hideNotes()">‚Üê Back</button>
</div>

<div class="overlay" id="overlay" onclick="closeModals()"></div>

<div class="modal" id="importanceModal">
    <h2 id="importanceHeading" onclick="importanceClick()">STUDY HUB</h2>
    <p>Importance of Study: Knowledge is power. Education is the passport to the future, for tomorrow belongs to those who prepare for it today.</p>
</div>

<div class="modal" id="aboutModal">
    <h2>About</h2>
    <p>Developers</p>
    <h3 style="color:#00f2ff; margin:10px;">REVANTH & SANDEEP</h3>
    <button class="owner-btn" onclick="closeModals()">Close</button>
</div>

<footer id="footerTrigger">¬© 2026 Education Portal </footer>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyArqJycgZtlLpM7KQ2T9h-e2eJUHtMg-TY",
        authDomain: "tff-earns.firebaseapp.com",
        projectId: "tff-earns",
        storageBucket: "tff-earns.firebasestorage.app",
        messagingSenderId: "762695597074",
        appId: "1:762695597074:web:9956bd13d3aaf763b26ccb"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const dataRef = doc(db, "hub", "mainData");

    let subjectData = {};
    let isAdmin = false;
    let currentSubjectKey = '';
    let selectedUnitIdx = null;
    let footClicks = 0, headClicks = 0;

    // --- Admin Trigger Logic ---
    document.getElementById('footerTrigger').onclick = () => {
        footClicks++;
        if(footClicks === 5) {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('importanceModal').style.display = 'block';
            footClicks = 0;
        }
    };

    window.importanceClick = () => {
        headClicks++;
        if(headClicks === 5) {
            if(prompt("Enter Admin Password:") === "study11") {
                isAdmin = true;
                document.getElementById('admin-panel').style.display = 'block';
                closeModals();
                renderDashboard();
            }
            headClicks = 0;
        }
    };

    // --- Firebase Sync ---
    onSnapshot(dataRef, (snap) => {
        if (snap.exists()) {
            subjectData = snap.data();
            renderDashboard();
            if(document.getElementById('notesArea').style.display === 'block') renderUnits();
        }
    });

    async function sync() { await setDoc(dataRef, subjectData); }

    // --- Core Functions ---
    window.renderDashboard = () => {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = '';
        for (let key in subjectData) {
            grid.innerHTML += `
                <div class="card" onclick="showNotes('${key}')">
                    <i class="${subjectData[key].icon}" style="color: ${subjectData[key].color}"></i>
                    <h3>${subjectData[key].title}</h3>
                </div>`;
        }
    };

    window.showNotes = (key) => {
        currentSubjectKey = key;
        document.getElementById('mainGrid').style.display = 'none';
        document.getElementById('notesArea').style.display = 'block';
        document.getElementById('noteTitle').innerText = subjectData[key].title;
        document.getElementById('admin-url-box').style.display = isAdmin ? 'block' : 'none';
        document.getElementById('viewer-container').style.display = 'none';
        renderUnits();
    };

    window.renderUnits = () => {
        const list = document.getElementById('unitList');
        list.innerHTML = '';
        subjectData[currentSubjectKey].units.forEach((unit, i) => {
            list.innerHTML += `
                <div class="unit-card" onclick="openWebView(${i})">
                    <span>${unit}</span>
                    <i class="fa-solid fa-chevron-right"></i>
                </div>`;
        });
    };

    window.openWebView = (i) => {
        selectedUnitIdx = i;
        const url = subjectData[currentSubjectKey].links[i];
        if(!url || url === "#") return alert("No URL linked yet.");
        
        const container = document.getElementById('viewer-container');
        const iframe = document.getElementById('web-view');
        container.style.display = 'block';
        iframe.src = url;

        // Setup Download
        document.getElementById('dlBtn').onclick = () => {
            const a = document.createElement('a');
            a.href = url;
            a.download = `${subjectData[currentSubjectKey].title}_Notes.pdf`;
            a.target = "_blank";
            a.click();
        };
        
        container.scrollIntoView({ behavior: 'smooth' });
    };

    window.saveUrl = async () => {
        if(selectedUnitIdx === null) return alert("Select a unit first!");
        const url = document.getElementById('pdfUrlInput').value;
        subjectData[currentSubjectKey].links[selectedUnitIdx] = url;
        await sync();
        alert("URL Linked!");
    };

    window.toggleFullScreen = () => {
        const elem = document.getElementById('web-view');
        if (elem.requestFullscreen) elem.requestFullscreen();
        else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
    };

    window.addSubject = async () => {
        let n = prompt("Subject Name:");
        if(n) {
            let k = n.toLowerCase().replace(/\s/g, '');
            subjectData[k] = { title: n, icon: 'fa-solid fa-book', color: '#00f2ff', units: ["Unit 1", "Unit 2"], links: ["#", "#"] };
            await sync();
        }
    };

    window.showAbout = () => {
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('aboutModal').style.display = 'block';
    };

    window.closeModals = () => {
        document.querySelectorAll('.modal, .overlay').forEach(el => el.style.display = 'none');
    };

    window.hideNotes = () => {
        document.getElementById('mainGrid').style.display = 'grid';
        document.getElementById('notesArea').style.display = 'none';
    };

    window.handleSearch = () => {
        let f = document.getElementById('masterSearch').value.toLowerCase();
        document.querySelectorAll('.card').forEach(c => c.style.display = c.innerText.toLowerCase().includes(f) ? 'block' : 'none');
    };
</script>
</body>
</html>
